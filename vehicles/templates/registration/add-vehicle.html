{% extends 'base.html' %}

{% block title %}添加汽车 - {% endblock %}

{% block content %}
	<h2>添加汽车</h2>
	<form method="post" id="addVehicleForm">
		<label for="plate">车牌:
			<input name="plate" id="plate" required>
		</label>

		<label for="insurance">车险:
			<input name="insurance" id="insurance" required>
		</label>

		<label for="inspection">年审:
			<input name="inspection" id="inspection" required>
		</label>

		<label for="maintenance">保养:
			<input name="maintenance" id="maintenance" required>
		</label>

		<input type="submit" value="添加" name="add-vehicle">
	</form>

	<div id="message"></div>

	<a href="{{ url_for('index') }}">返回</a>

	<script>
		document.getElementById('addVehicleForm').addEventListener('submit', async function(event) {
			event.preventDefault()
			
			const messageDiv = document.getElementById('message')
		
			const formData = {
				plate: document.getElementById('plate').value,
				insurance: document.getElementById('insurance').value,
				inspection: document.getElementById('inspection').value,
				maintenance: document.getElementById('maintenance').value
			}

			try {
				const response = await fetch('/add-vehicle', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify(formData)
				})

				const result = await response.json()

				if (response.ok) {
					messageDiv.textContent = result.message || '添加成功'
					messageDiv.style.display = 'block'
					this.reset()
					
					setTimeout(() => {
						messageDiv.style.display = 'none'
					}, 3000)
				} else {
					messageDiv.textContent = result.error || '添加失败'
					messageDiv.style.display = 'block'
				}
			} catch (error) {
				console.error('Error', error)
				messageDiv.textContent = "网络错误"
				messageDiv.style.display = 'block'
			}
		})
	</script>
{% endblock %}
